<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
	<head>
		<!-- <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"> -->
		<%- include('../partials/head'); %>
	</head>
	<body class="vertical-layout vertical-menu 2-columns   menu-expanded fixed-navbar" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-purple-blue" data-col="2-columns">
		<!-- fixed-top-->
		<%- include('../partials/header'); %>
		<!-- ////////////////////////////////////////////////////////////////////////////-->
		<%- include('../partials/sidebar'); %>
		<% if(loadedData === ''){ %>
			<script>
				$.toast({
					heading: 'Please Load Data From Database',
					text: 'Click Get Data Button',
					showHideTransition: 'slide',
					icon: 'success',
					hideAfter: 5000   // in milli seconds
				})
				</script>
		<%}%>

		<div class="app-content content">
			<div class="content-wrapper">
				<div class="content-wrapper-before">
					
				</div>
				<div class="content-header row">
					<div class="content-header-left col-md-4 col-12 mb-2">
					<h3 class="content-header-title">Tables</h3>
					</div>
					<div class="content-header-right col-md-8 col-12">
						<div class="breadcrumbs-top float-md-right">
							<div class="breadcrumb-wrapper mr-1">
								<ol class="breadcrumb">
									<li class="breadcrumb-item"><a href="/">Home</a>
									</li>
									<li class="breadcrumb-item active">Tables
									</li>
								</ol>
							</div>
						</div>
					</div>
				</div>
				<div class="content-body">
					
					<!-- Table head options start -->
					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
									<h4 class="card-title">Owl Studio Model Table</h4>
									<a class="heading-elements-toggle"><i class="la la-ellipsis-v font-medium-3"></i></a>
									<div class="heading-elements">
											<a data-action="expand"><i class="ft-maximize"></i></a>
										</ul>
									</div>
								</div>
								<div class="card-content collapse show">
									<div class="card-body" style="padding-bottom: 0px;">
										<div class="row">
											<div class="col-md-9">
												<p>This is Owl Studio Model Table.
													<br>You can load history and view 3d models.
												</p>
											</div>
											<div class="col-md-3">
												<input type="button" style="float: right;" class="btn btn-success btn-min-width mr-1 mb-1" value='Get Data' style="float: bottom" onclick="onclick_get()">
											</div>
										</div>
										<% if (messages.error) { %>
											<!-- <p style="color:red"><%- messages.error %></p> -->
											<script>
												$.toast({
													heading: 'Error',
													text: '<%- messages.error %>',
													showHideTransition: 'fade',
													icon: 'error',
													hideAfter: 1500   // in milli seconds
												});
												</script>
										<% } else{
											if (messages.success) { %>
											<!-- <p style="color:green"><%- messages.success %></p> -->
											<script>
												$.toast({
													heading: 'Success',
													text: '<%- messages.success %>',
													showHideTransition: 'slide',
													icon: 'success',
													hideAfter: 1500   // in milli seconds
												});
												</script>
										<% } else {
											if(loadedData !== ''){ %>
											<!-- <p style="color:green"><%- messages.success %></p> -->
											<script>
												$.toast({
													heading: 'Reload Database',
													text: 'Reload Latest Data',
													showHideTransition: 'slide',
													icon: 'success',
													hideAfter: 1500   // in milli seconds
												});
											</script>
										<% } } }%>	      
									</div>
									<div class="table-padding-set">
										<div class="table-responsive">
											<table class="table table-striped">
												<colgroup>
													<col style="width: 20%;">
													<col style="width: 15%;">
													<col style="width: 10%;">
													<col style="width: 20%;">
													<col style="width: 20%;">
													<col style="width: 15%;">
												</colgroup>
												<thead class="thead-dark">
													<tr>
														<th scope="col">Name</th>
														<th scope="col">Date</th>
														<th scope="col">Time</th>
														<th scope="col">Mass</th>
														<th scope="col">Volume</th>
														<th scope="col">#</th>
													</tr>
												</thead>
												<tbody id='table_main_data'>
													
												</tbody>
											</table>
											<div style="display: flex; justify-content: center;" id="prepross"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Table head options end -->
					
				</div>
			</div>
		</div>
<!-- ////////////////////////////////////////////////////////////////////////////-->

	<%- include('../partials/footer'); %>
	<script>
		var jsdata = <%- JSON.stringify(loadedData) %>; 
	</script>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
	<script src="https://cdn.datatables.net/fixedcolumns/4.0.0/js/dataTables.fixedColumns.min.js"></script>
	<script src="/js/alert_getmodelfromdb.js" type="text/javascript"></script>
   	<script type="text/javascript">
		$(document).ready(()=>{
			$('#table_main_data').html('');
			table = $('table').DataTable( {
				responsive: true,
				autoWidth: true,
				"processing": true,
				data: jsdata,
				order: [[ 1, "desc" ]],
				scrollX:        true,
				scrollCollapse: true,
				fixedColumns: {
					left: 1,
				},
				columns: [
					{ data: 'name',width: '25%', responsivePriority: 1, targets: 0 },
					{ data: 'date', width: '30%', targets: 1},
					{ data: 'time', width: '30%', targets: 2},
					{ data: 'mass', width: '30%', targets: 3},
					{ data: 'volume', width: '30%', targets: 4},
					{ data: 'setid', width: '30%',targets: 5, render:function ( data, type, row ) {
					return '<a href="/data/view/' + row._id + '" class="btn btn-primary btn-min-width mr-1 mb-1">View</a>';}},
				],
			});

            setTimeout(() => {
                document.location.href = '/data';
            },<%= delaytime%>);
		});
	</script>
	</body>
</html>